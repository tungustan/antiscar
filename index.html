<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Mobile Bunny Player</title>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  height: 100%;
  overflow: hidden;
  touch-action: manipulation;
  -webkit-tap-highlight-color: transparent;
}

#loginBox {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  text-align: center;
}

input {
  padding: 12px;
  font-size: 18px;
  width: 200px;
}

button {
  padding: 12px 20px;
  font-size: 18px;
  margin-top: 10px;
}

#playerSection {
  display: none;
  width: 100vw;
  height: 100vh;
}

iframe {
  width: 100%;
  height: 100%;
  border: none;
}
</style>
</head>
<body>

<div id="loginBox">
  <h2 style="color:white;">비밀번호 입력</h2>
  <input type="password" id="pw" />
  <br>
  <button onclick="checkPassword()">접속</button>
  <p id="error" style="color:red;"></p>
</div>

<div id="playerSection">
  <iframe id="bunnyPlayer"
    allow="autoplay; fullscreen"
    allowfullscreen>
  </iframe>
</div>

<script>
const correctPassword = "12345";

const libraryId = "603895";
const apiKey = "76261b03-34c8-4124-a50b3e6ef178-3abd-41f8";
const embedBase = "https://iframe.mediadelivery.net/embed/603895/";

let videos = [];
let currentIndex = 0;

function checkPassword(){
  if(document.getElementById("pw").value === correctPassword){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("playerSection").style.display="block";
    loadVideos();
  } else {
    document.getElementById("error").innerText="비밀번호 틀림";
  }
}

async function loadVideos(){
  try{
    const res = await fetch(`https://video.bunnycdn.com/library/${libraryId}/videos?page=1&itemsPerPage=100`,{
      headers:{ "AccessKey": apiKey }
    });

    const data = await res.json();
    videos = data.items || [];

    videos.sort((a,b)=>(a.title||"").localeCompare(b.title||"",'ko'));

    if(videos.length){
      playVideo(0);
    } else {
      alert("영상이 없습니다.");
    }

  }catch(e){
    alert("API 오류 (CORS 또는 키 문제)");
    console.error(e);
  }
}

function playVideo(index){
  currentIndex = index;

  const videoId = videos[index].guid;

  const url =
    `${embedBase}${videoId}` +
    `?autoplay=true` +
    `&muted=false` +
    `&playsinline=true` +
    `&captions=false` +     // 자막 버튼 숨김
    `&chromecast=false`;    // 캐스트 버튼 숨김

  document.getElementById("bunnyPlayer").src = url;
}

/* 다음 영상 자동 전환 (모바일용 타이머 방식) */
async function autoNext(){
  if(currentIndex + 1 < videos.length){
    playVideo(currentIndex + 1);
  }
}

// Bunny iframe ended 직접 감지 불가 → 간단한 대기 후 전환 방식 필요
// 실제 정확 감지는 Bunny Player JS SDK 필요

</script>

</body>
</html>
