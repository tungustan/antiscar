<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Protected Bunny Playlist</title>
  <style>
    body {
      margin: 0;
      background: black;
      color: white;
      font-family: Arial, sans-serif;
      text-align: center;
    }

    #loginBox {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }

    input {
      padding: 10px;
      font-size: 16px;
      margin-top: 10px;
    }

    button {
      padding: 10px 20px;
      font-size: 16px;
      margin-top: 10px;
      cursor: pointer;
    }

    #videoSection {
      display: none;
    }

    video {
      width: 100%;
      height: 100vh;
      object-fit: contain;
      background: black;
    }

    #title {
      position: absolute;
      top: 10px;
      left: 0;
      right: 0;
      font-size: 18px;
      background: rgba(0,0,0,0.5);
      padding: 5px;
    }

    #error {
      color: red;
      margin-top: 10px;
    }
  </style>
</head>
<body>

<div id="loginBox">
  <h2>비밀번호를 입력하세요</h2>
  <input type="password" id="passwordInput" placeholder="비밀번호">
  <br>
  <button onclick="checkPassword()">접속</button>
  <div id="error"></div>
</div>

<div id="videoSection">
  <div id="title">Loading...</div>
  <video id="videoPlayer" autoplay muted playsinline></video>
</div>

<script>
  const correctPassword = "12345";

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    const errorDiv = document.getElementById("error");

    if (input === correctPassword) {
      document.getElementById("loginBox").style.display = "none";
      document.getElementById("videoSection").style.display = "block";
      fetchVideos();
    } else {
      errorDiv.textContent = "비밀번호가 틀렸습니다.";
    }
  }

  const libraryId = "603895";
  const apiKey = "YOUR_NEW_API_KEY_HERE"; // 반드시 새 키 사용
  const pullZoneUrl = "https://vz-af7f48b7-cd1.b-cdn.net";

  const player = document.getElementById("videoPlayer");
  const titleDiv = document.getElementById("title");

  let videos = [];
  let currentIndex = 0;

  async function fetchVideos() {
    try {
      const response = await fetch(
        `https://video.bunnycdn.com/library/${libraryId}/videos?page=1&itemsPerPage=100`,
        {
          headers: {
            "AccessKey": apiKey
          }
        }
      );

      const data = await response.json();
      videos = data.items || [];

      if (videos.length === 0) {
        titleDiv.textContent = "영상이 없습니다.";
        return;
      }

      videos.sort((a, b) =>
        (a.title || "").localeCompare(b.title || "", 'ko')
      );

      playVideo(0);
    } catch (error) {
      titleDiv.textContent = "영상 목록을 불러오지 못했습니다.";
      console.error(error);
    }
  }

  function playVideo(index) {
    currentIndex = index;
    const video = videos[index];

    const videoUrl = `${pullZoneUrl}/${video.guid}/play_720p.mp4`;

    player.src = videoUrl;
    titleDiv.textContent = video.title || "Untitled";
    player.play().catch(() => {});
  }

  player.addEventListener("ended", () => {
    let nextIndex = currentIndex + 1;

    if (nextIndex < videos.length) {
      playVideo(nextIndex);
    } else {
      titleDiv.textContent = "모든 영상 재생 완료";
    }
  });

  // 엔터키로 로그인
  document.getElementById("passwordInput").addEventListener("keypress", function(e) {
    if (e.key === "Enter") {
      checkPassword();
    }
  });
</script>

</body>
</html>
