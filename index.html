<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>Bunny Embed Playlist</title>
<style>
body { margin:0; background:black; color:white; font-family:Arial; text-align:center; }
#loginBox { position:absolute; top:50%; left:50%; transform:translate(-50%,-50%); }
#playerSection { display:none; height:100vh; }
iframe { width:100%; height:100vh; border:none; }
</style>
</head>
<body>

<div id="loginBox">
<h2>ë¹„ë°€ë²ˆí˜¸ ì…ë ¥</h2>
<input type="password" id="pw">
<br>
<button onclick="checkPassword()">ì ‘ì†</button>
<p id="error" style="color:red;"></p>
</div>

<div id="playerSection">
<iframe id="bunnyPlayer"
allow="autoplay; fullscreen"
allowfullscreen>
</iframe>
</div>

<script>
const correctPassword = "12345";

const libraryId = "603895";
const apiKey = "76261b03-34c8-4124-a50b3e6ef178-3abd-41f8";
const embedBase = "https://iframe.mediadelivery.net/embed/603895/";

let videos = [];
let currentIndex = 0;

function checkPassword(){
  if(document.getElementById("pw").value === correctPassword){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("playerSection").style.display="block";
    loadVideos();
  }else{
    document.getElementById("error").innerText="ë¹„ë°€ë²ˆí˜¸ í‹€ë¦¼";
  }
}

async function loadVideos(){
  try{
    const res = await fetch(`https://video.bunnycdn.com/library/${libraryId}/videos?page=1&itemsPerPage=100`,{
      headers:{ "AccessKey": apiKey }
    });
    const data = await res.json();
    videos = data.items || [];

    videos.sort((a,b)=>(a.title||"").localeCompare(b.title||"",'ko'));

    if(videos.length){
      playVideo(0);
    }else{
      alert("ì˜ìƒì´ ì—†ìŠµë‹ˆë‹¤.");
    }

  }catch(e){
    alert("API ì˜¤ë¥˜ (CORS ë˜ëŠ” í‚¤ ë¬¸ì œ)");
    console.error(e);
  }
}

function playVideo(index){
  currentIndex = index;

  const videoId = videos[index].guid;

  // ğŸ”¥ Bunny ê¸°ë³¸ í”Œë ˆì´ì–´ ì‚¬ìš©
  // autoplay=1 â†’ ìë™ì¬ìƒ
  // muted=0 â†’ ì†Œë¦¬ ì¼œì§
  // captions=0 â†’ ìë§‰ ë²„íŠ¼ ìˆ¨ê¹€
  const url = `${embedBase}${videoId}?autoplay=true&muted=false&captions=false`;

  document.getElementById("bunnyPlayer").src = url;
}

// ë‹¤ìŒ ì˜ìƒ ìë™ ì¬ìƒì„ ìœ„í•´ 5ì´ˆë§ˆë‹¤ ì²´í¬
// (Bunny iframeì€ ended ì´ë²¤íŠ¸ ì§ì ‘ ì ‘ê·¼ ë¶ˆê°€)
setInterval(()=>{
  const iframe = document.getElementById("bunnyPlayer");

  if(!videos.length) return;

  // ì˜ìƒ ê¸¸ì´ë§Œí¼ ëŒ€ê¸° í›„ ë‹¤ìŒ ì˜ìƒ ë¡œë“œ ë°©ì‹ ëŒ€ì‹ 
  // ì‹¤ì œ ì„œë¹„ìŠ¤ì—ì„œëŠ” Bunny Player API ì—°ë™ ê°€ëŠ¥
},5000);
</script>

</body>
</html>
