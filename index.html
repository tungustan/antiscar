<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>Bunny Video Playlist</title>
  <style>
    body {
      background: #111;
      color: white;
      text-align: center;
      font-family: Arial, sans-serif;
    }
    video {
      width: 80%;
      max-width: 1000px;
      margin-top: 20px;
    }
    #title {
      margin-top: 20px;
      font-size: 20px;
    }
  </style>
</head>
<body>

<h1>Video Playlist</h1>
<div id="title">Loading...</div>
<video id="videoPlayer" controls autoplay></video>

<script>
  const libraryId = "603895";
  const apiKey = "949e6132-ca0a-43b7-853f381e9d25-08e7-4ce6";
  const pullZoneUrl = "https://vz-af7f48b7-cd1.b-cdn.net"; // Bunny Pull Zone URL

  const player = document.getElementById("videoPlayer");
  const titleDiv = document.getElementById("title");

  let videos = [];
  let currentIndex = 0;

  async function fetchVideos() {
    const response = await fetch(
      `https://video.bunnycdn.com/library/${libraryId}/videos`,
      {
        headers: {
          "AccessKey": apiKey
        }
      }
    );

    const data = await response.json();
    videos = data.items;

    // 이름순 정렬
    videos.sort((a, b) => a.title.localeCompare(b.title));

    playVideo(0);
  }

  function playVideo(index) {
    if (!videos.length) return;

    currentIndex = index;
    const video = videos[index];

    const videoUrl = `${pullZoneUrl}/${video.guid}/play_720p.mp4`;

    player.src = videoUrl;
    titleDiv.textContent = video.title;
    player.play();
  }

  player.addEventListener("ended", () => {
    let nextIndex = currentIndex + 1;
    if (nextIndex >= videos.length) {
      nextIndex = 0; // 처음으로 루프
    }
    playVideo(nextIndex);
  });

  fetchVideos();
</script>

</body>
</html>
