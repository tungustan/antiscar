<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>Mobile Bunny Auto Playlist</title>

<script src="https://iframe.mediadelivery.net/player.js"></script>

<style>
html, body {
  margin: 0;
  padding: 0;
  background: black;
  height: 100%;
  overflow: hidden;
}

#loginBox {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: white;
  text-align: center;
}

#playerSection {
  display: none;
  width: 100vw;
  height: 100vh;
}

#player {
  width: 100%;
  height: 100%;
}
</style>
</head>
<body>

<div id="loginBox">
  <h2>비밀번호 입력</h2>
  <input type="password" id="pw">
  <br>
  <button onclick="checkPassword()">접속</button>
  <p id="error" style="color:red;"></p>
</div>

<div id="playerSection">
  <div id="player"></div>
</div>

<script>
const correctPassword = "12345";

const libraryId = 603895;
const apiKey = "76261b03-34c8-4124-a50b3e6ef178-3abd-41f8";

let videos = [];
let currentIndex = 0;
let playerInstance;

function checkPassword(){
  if(document.getElementById("pw").value === correctPassword){
    document.getElementById("loginBox").style.display="none";
    document.getElementById("playerSection").style.display="block";
    loadVideos();
  } else {
    document.getElementById("error").innerText="비밀번호 틀림";
  }
}

async function loadVideos(){
  try{
    const res = await fetch(`https://video.bunnycdn.com/library/${libraryId}/videos?page=1&itemsPerPage=100`,{
      headers:{ "AccessKey": apiKey }
    });

    const data = await res.json();
    videos = data.items || [];

    videos.sort((a,b)=>(a.title||"").localeCompare(b.title||"",'ko'));

    if(videos.length){
      initPlayer(videos[0].guid);
    } else {
      alert("영상이 없습니다.");
    }

  }catch(e){
    alert("API 오류 (CORS 또는 키 문제)");
    console.error(e);
  }
}

function initPlayer(videoId){

  playerInstance = new playerjs.Player('player', {
    file: videoId,
    library: libraryId,
    autoplay: true,
    muted: false,
    captions: false,
    chromecast: false
  });

  playerInstance.on('ended', function(){
    nextVideo();
  });
}

function nextVideo(){
  if(currentIndex + 1 < videos.length){
    currentIndex++;
    playerInstance.load(videos[currentIndex].guid);
  }
}
</script>

</body>
</html>
